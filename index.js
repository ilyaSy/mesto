(()=>{"use strict";function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var t=function(){function t(e){var n=e.tokenAuth,o=e.tokenGroup,r=e.apiURL;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this._apiURL="".concat(r,"/").concat(o),this._headers={authorization:n,"Content-Type":"application/json"}}var n,o;return n=t,(o=[{key:"getInitialCards",value:function(){return fetch("".concat(this._apiURL,"/cards"),{headers:this._headers}).then(this._handleApiResult.bind(null,"getInitialCards"))}},{key:"addCard",value:function(e){return fetch("".concat(this._apiURL,"/cards"),{method:"POST",headers:this._headers,body:JSON.stringify(e)}).then(this._handleApiResult.bind(null,"addCard"))}},{key:"likeCard",value:function(e,t){return fetch("".concat(this._apiURL,"/cards/likes/").concat(e),{method:t?"DELETE":"PUT",headers:this._headers}).then(this._handleApiResult.bind(null,"likeCard"))}},{key:"deleteCard",value:function(e){return fetch("".concat(this._apiURL,"/cards/").concat(e),{method:"DELETE",headers:this._headers}).then(this._handleApiResult.bind(null,"deleteCard"))}},{key:"editUserInfo",value:function(e){return fetch("".concat(this._apiURL,"/users/me"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._handleApiResult.bind(null,"editUserInfo"))}},{key:"getUserInfo",value:function(){return fetch("".concat(this._apiURL,"/users/me"),{headers:this._headers}).then(this._handleApiResult.bind(null,"getUserInfo"))}},{key:"setUserAvatar",value:function(e){return fetch("".concat(this._apiURL,"/users/me/avatar"),{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._handleApiResult.bind(null,"setUserAvatar"))}},{key:"_handleApiResult",value:function(e,t){return t.ok?t.json():Promise.reject("Ошибка получения результата в ".concat(e,": ").concat(t.status," ").concat(t.statusText))}}])&&e(n.prototype,o),t}();function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var o=function(){function e(t,n){var o,r,i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=function(){return i._inputList.some((function(e){return!e.validity.valid}))},(o="_hasInvalidInput")in this?Object.defineProperty(this,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[o]=r,this._formElement=n,this._inputSelector=t.inputSelector,this._submitButtonSelector=t.submitButtonSelector,this._inactiveButtonClass=t.inactiveButtonClass,this._inputErrorClass=t.inputErrorClass,this._errorClass=t.errorClass,this._inputList=Array.from(this._formElement.querySelectorAll(this._inputSelector)),this._buttonElement=this._formElement.querySelector(this._submitButtonSelector)}var t,o;return t=e,(o=[{key:"_showInputError",value:function(e,t){var n=this._formElement.querySelector(".".concat(e.name,"-error"));e.classList.add(this._inputElement),n.textContent=t,n.classList.add(this._errorClass)}},{key:"_hideInputError",value:function(e){var t=this._formElement.querySelector(".".concat(e.name,"-error"));e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_toggleButtonState",value:function(){this._hasInvalidInput()?(this._buttonElement.classList.add(this._inactiveButtonClass),this._buttonElement.disabled=!0):(this._buttonElement.classList.remove(this._inactiveButtonClass),this._buttonElement.disabled=!1)}},{key:"_setEventListeners",value:function(){var e=this;this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState()}))}))}},{key:"_initializeErrorFields",value:function(){var e=this;this._toggleButtonState(),this._inputList.forEach((function(t){e._hideInputError(t)}))}},{key:"initializeValidation",value:function(){this._initializeErrorFields()}},{key:"enableValidation",value:function(){this._formElement.addEventListener("submit",(function(e){e.preventDefault()})),this._setEventListeners()}}])&&n(t.prototype,o),e}();function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u=function(){function e(t){var n=this,o=t.card,i=t.cardSelector,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},l=arguments.length>2?arguments[2]:void 0,c=l.likeCard,s=void 0===c?function(){}:c,p=l.deleteCard,f=void 0===p?function(){}:p,_=arguments.length>3?arguments[3]:void 0,d=_.openConfirm,h=void 0===d?function(){}:d,v=_.closeConfirm,y=void 0===v?function(){}:v,m=_.setConfirmSubmit,b=void 0===m?function(){}:m;r(this,e),a(this,"_handleLike",(function(e){var t=e.target.classList.contains("element__caption-like_active");n._likeCard(n._card._id,t).then((function(t){n._captionLikeCount.textContent=t.likes?t.likes.length:0,e.target.classList.toggle("element__caption-like_active")})).catch((function(e){return console.log("Ошибка: "+e)}))})),a(this,"_handleDelete",(function(e){n._deleteCard(n._card._id).then((function(t){e.target.closest(".element").remove(),n._closeConfirm()})).catch((function(e){return console.log("Ошибка: "+e)}))})),a(this,"_handleOpenPopup",(function(){return n._openPopup(n._card.link,n._card.name)})),a(this,"setBtnStatus",(function(e,t){n._element.querySelector(e).classList.add(t)})),this._card=o,this._cardSelector=i,this._openPopup=u,this._likeCard=s,this._deleteCard=f,this._openConfirm=h,this._closeConfirm=y,this._setConfirmSubmit=b}var t,n;return t=e,(n=[{key:"_setEventListeners",value:function(){var e=this;this._element.querySelector(".element__caption-like").addEventListener("click",this._handleLike),this._element.querySelector(".element__delete-button").addEventListener("click",(function(t){e._openConfirm(),e._setConfirmSubmit((function(n){n.preventDefault(),e._handleDelete(t)}))})),this._picture.addEventListener("click",this._handleOpenPopup)}},{key:"_getTemplate",value:function(){return document.querySelector(this._cardSelector).content.cloneNode(!0)}},{key:"generate",value:function(){return this._element=this._getTemplate(),this._picture=this._element.querySelector(".element__picture"),this._picture.src=this._card.link,this._picture.alt="Фото: ".concat(this._card.name),this._element.querySelector(".element__caption-text").textContent=this._card.name,this._captionLikeCount=this._element.querySelector(".element__caption-like-count"),this._captionLikeCount.textContent=this._card.likes?this._card.likes.length:0,this._setEventListeners(),this._element}}])&&i(t.prototype,n),e}();function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var s=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),c(this,"_closeByEscapeBtn",(function(e){"Escape"===e.key&&n.closePopup.call(n)})),c(this,"_closeByClickOnOverlay",(function(e){e.target.classList.contains("popup_opened")&&n.closePopup.call(n)})),this._popup=document.querySelector(t),this._popupCloseBtn=this._popup.querySelector(".popup__close-button")}var t,n;return t=e,(n=[{key:"openPopup",value:function(){this._popup.classList.add("popup_opened"),document.addEventListener("keydown",this._closeByEscapeBtn)}},{key:"closePopup",value:function(){this._popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._closeByEscapeBtn)}},{key:"setEventListeners",value:function(){this._popupCloseBtn.addEventListener("click",this.closePopup.bind(this)),this._popup.addEventListener("click",this._closeByClickOnOverlay)}}])&&l(t.prototype,n),e}();function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=y(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function y(e){return(y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(a,e);var t,n,o,r,i=(o=a,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=y(o);if(r){var n=y(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return d(this,e)});function a(e){var t,n,o,r=e.popupSelector,u=e.handleFormSubmit,l=void 0===u?function(){}:u,c=e.handleInitialize,s=void 0===c?function(){}:c;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),m(h(o=i.call(this,r)),"openPopup",(function(){o._handleInitialize(),v((t=h(o),y(a.prototype)),"openPopup",t).call(t)})),m(h(o),"closePopup",(function(){v((n=h(o),y(a.prototype)),"closePopup",n).call(n),o._form.reset()})),m(h(o),"setStartLoadingText",(function(){o._submitButton.textContent=o._submitButtonBaseText+"..."})),m(h(o),"setStopLoadingText",(function(){o._submitButton.textContent=o._submitButtonBaseText})),m(h(o),"_getInputValues",(function(){return o._inputList=o._form.querySelectorAll(".popup__input"),o._formValues={},o._inputList.forEach((function(e){o._formValues[e.name]=e.value})),o._formValues})),o._handleFormSubmit=l,o._handleInitialize=s,o._form=o._popup.querySelector(".popup__container"),o._submitButton=o._form.querySelector(".popup__save-button"),o._submitButtonBaseText=o._submitButton.textContent,o}return t=a,(n=[{key:"setEventListeners",value:function(e){var t=this;v(y(a.prototype),"setEventListeners",this).call(this),e&&"function"==typeof e?this._form.addEventListener("submit",e):this._form.addEventListener("submit",(function(e){t._handleFormSubmit(e,t._getInputValues())}))}}])&&f(t.prototype,n),a}(s);function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?C(e):t}function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function E(e,t,n){return(E="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=L(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function L(e){return(L=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(r,e);var t,n,o=(t=r,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,o=L(t);if(n){var r=L(this).constructor;e=Reflect.construct(o,arguments,r)}else e=o.apply(this,arguments);return k(this,e)});function r(e){var t,n,i,a,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),u=function(e,o){n._popupPicture.src=e,n._popupPicture.alt="Фото: ".concat(o),n._popupCaption.textContent=o,E((t=C(n),L(r.prototype)),"openPopup",t).call(t)},(a="openPopup")in(i=C(n=o.call(this,e)))?Object.defineProperty(i,a,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[a]=u,n._popupPicture=n._popup.querySelector(".popup__picture"),n._popupCaption=n._popup.querySelector(".popup__caption"),n}return r}(s);function P(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var O=function(){function e(t,n){var o,r,i=this,a=t.renderer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),r=function(){i._container.innerHTML=""},(o="_clear")in this?Object.defineProperty(this,o,{value:r,enumerable:!0,configurable:!0,writable:!0}):this[o]=r,this._renderer=a,this._container=document.querySelector(n)}var t,n;return t=e,(n=[{key:"renderItems",value:function(e){var t=this;this._clear(),e.length?e.forEach((function(e){t._renderer(e)})):this._container.textContent="Нет фотографий"}},{key:"addItem",value:function(e){this._container.prepend(e)}}])&&P(t.prototype,n),e}();function B(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var I=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._profileName=document.querySelector(t),this._profileJob=document.querySelector(n),this._profileAvatar=document.querySelector(o)}var t,n;return t=e,(n=[{key:"id",get:function(){return this._id},set:function(e){this._id=e}},{key:"getUserInfo",value:function(){return{profileName:this._profileName.textContent,profileJob:this._profileJob.textContent}}},{key:"setUserInfo",value:function(e){this._profileName.textContent=e.profileName,this._profileJob.textContent=e.profileJob,this._profileAvatar.src=e.avatar}}])&&B(t.prototype,n),e}(),R=".elements",q=(document.querySelector(R),document.querySelector(".popup_type_edit")),j=document.querySelector(".popup_type_add"),T=document.querySelector(".popup_type_ava"),x=q.querySelector(".popup__container"),U=j.querySelector(".popup__container"),A=T.querySelector(".popup__container"),V=q.querySelector(".popup__input_value_name"),z=q.querySelector(".popup__input_value_job"),N=document.querySelector(".profile"),J=N.querySelector(".profile__edit-button"),D=N.querySelector(".profile__edit-ava-button"),F=N.querySelector(".profile__add-button"),H={inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},G=new t({tokenAuth:"30b18b22-df4e-456d-bb26-16cda3a69c12",tokenGroup:"cohort-21",apiURL:"https://mesto.nomoreparties.co/v1"}),M=new w(".popup_type_show");M.setEventListeners();var K=new b({popupSelector:".popup_type_confirm"}),Q=new O({renderer:function(e){Q.addItem(X(e))}},R),W=new I(".profile__name",".profile__job",".profile__avatar");function X(e){var t=new u({card:e,cardSelector:"#element"},M.openPopup,{likeCard:G.likeCard.bind(G),deleteCard:G.deleteCard.bind(G)},{openConfirm:K.openPopup.bind(K),closeConfirm:K.closePopup.bind(K),setConfirmSubmit:K.setEventListeners.bind(K)}),n=t.generate();return e.owner._id!==W.id&&t.setBtnStatus(".element__delete-button","element__delete-button_disactive"),e.likes.some((function(e){return e._id===W.id}))&&t.setBtnStatus(".element__caption-like","element__caption-like_active"),n}Promise.all([G.getUserInfo(),G.getInitialCards()]).then((function(e){var t,n=e[0];W.id=n._id,W.setUserInfo({profileName:n.name,profileJob:n.about,avatar:n.avatar}),t=e[1],Q.renderItems(t.reverse())})).catch((function(e){return console.log("Ошибка: "+e)}));var Y=new b({popupSelector:".popup_type_edit",handleFormSubmit:function(e,t){e.preventDefault(),Y.setStartLoadingText(),G.editUserInfo({name:t.profileName,about:t.profileJob}).then((function(e){W.setUserInfo({profileName:e.name,profileJob:e.about,avatar:e.avatar}),Y.closePopup()})).catch((function(e){return console.log("Ошибка: "+e)})).finally(Y.setStopLoadingText())},handleInitialize:function(){var e=W.getUserInfo(),t=e.profileName,n=e.profileJob;V.value=t,z.value=n,ee.initializeValidation()}});Y.setEventListeners();var Z=new b({popupSelector:".popup_type_add",handleFormSubmit:function(e,t){e.preventDefault(),Z.setStartLoadingText(),G.addCard(t).then((function(e){Q.addItem(X(e)),Z.closePopup()})).catch((function(e){return console.log("Ошибка: "+e)})).finally(Z.setStopLoadingText())},handleInitialize:function(){te.initializeValidation()}});Z.setEventListeners();var $=new b({popupSelector:".popup_type_ava",handleFormSubmit:function(e,t){e.preventDefault(),$.setStartLoadingText(),G.setUserAvatar({avatar:t.profileAvatarLink}).then((function(e){W.setUserInfo({profileName:e.name,profileJob:e.about,avatar:e.avatar}),$.closePopup()})).catch((function(e){return console.log("Ошибка: "+e)})).finally($.setStopLoadingText())},handleInitialize:function(){ne.initializeValidation()}});$.setEventListeners();var ee=new o(H,x);ee.initializeValidation(),ee.enableValidation();var te=new o(H,U);te.initializeValidation(),te.enableValidation();var ne=new o(H,A);ne.initializeValidation(),ne.enableValidation(),J.addEventListener("click",Y.openPopup),F.addEventListener("click",Z.openPopup),D.addEventListener("click",$.openPopup)})();